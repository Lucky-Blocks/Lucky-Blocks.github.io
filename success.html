<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Order Successful - Lucky Blocks</title>
  <style>
    :root{
      --bg:#0b0f12;
      --accent:#c16cee;
      --accent-2:#1e90ff;
      --card:#071021;
      --muted:#8aa6b1;
      --radius:14px;
      --shadow: 0 6px 20px rgba(2,6,23,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color-scheme: dark;
    }
    body{margin:0;display:flex;align-items:center;justify-content:center;min-height:100vh;background:radial-gradient(circle at center,#0b0f12,#0a0e54);color:#e6f3f2;padding:16px}
    .card{background:linear-gradient(180deg,var(--card),rgba(0,0,0,0.3));padding:32px;border-radius:var(--radius);max-width:600px;width:100%;text-align:center;box-shadow:var(--shadow);}
    h1{margin-top:0;color:var(--accent);}
    p{color:var(--muted);}
    ul{list-style:none;padding:0;margin:20px 0}
    li{margin:6px 0;}
    .btn{margin-top:20px;display:inline-block;background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:12px 20px;border-radius:var(--radius);color:#021018;font-weight:700;text-decoration:none;box-shadow:0 6px 18px rgba(30,144,255,0.12);cursor:pointer}
    .review-form{margin-top:30px;text-align:left}
    .review-form textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:#021018;color:#e6f3f2;resize:vertical;min-height:80px;margin-bottom:10px}
    .review-msg{margin-top:10px;font-size:14px;color:var(--muted);}
  </style>
</head>
<body>
  <div class="card">
    <h1>üéâ Thank You!</h1>
    <p>Your order was successful. Here are your details:</p>
    <div id="order-details">Loading your order...</div>

    <!-- Review Form -->
    <div class="review-form">
      <h3 style="color:var(--accent)">Leave a Review</h3>
      <textarea id="review-input" placeholder="Share your experience..."></textarea>
      <button class="btn" onclick="submitReview()">Submit Review</button>
      <div id="review-msg" class="review-msg"></div>
    </div>

    <a href="index.html" class="btn">Continue Shopping</a>
  </div>

  <script>
    async function loadOrder() {
      const params = new URLSearchParams(window.location.search);
      const sessionId = params.get("session_id");
      if (!sessionId) {
        document.getElementById("order-details").textContent = "No order ID found.";
        return;
      }

      try {
        const res = await fetch("/order/" + sessionId);
        if (!res.ok) throw new Error("Order not found");
        const order = await res.json();

        document.getElementById("order-details").innerHTML = `
          <p><strong>Email:</strong> ${order.email}</p>
          <p><strong>Date:</strong> ${new Date(order.date).toLocaleString()}</p>
          <p><strong>Items:</strong></p>
          <ul>${order.items.split(", ").map(i=>`<li>${i}</li>`).join("")}</ul>
          <p><strong>Total Paid:</strong> $${order.total.toFixed(2)}</p>
        `;
      } catch (err) {
        console.error(err);
        document.getElementById("order-details").textContent = "Could not load order details.";
      }
    }

    async function submitReview() {
      const text = document.getElementById("review-input").value.trim();
      const msgBox = document.getElementById("review-msg");
      if (!text) {
        msgBox.textContent = "Please enter a review before submitting.";
        return;
      }

      try {
        const res = await fetch("/add-review", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });
        const data = await res.json();
        if (data.success) {
          msgBox.style.color = "limegreen";
          msgBox.textContent = "‚úÖ Thank you! Your review has been submitted.";
          document.getElementById("review-input").value = "";
        } else {
          throw new Error(data.error || "Unknown error");
        }
      } catch (err) {
        console.error(err);
        msgBox.style.color = "red";
        msgBox.textContent = "‚ùå Failed to submit review.";
      }
    }

    loadOrder();
  </script>
</body>
</html>
